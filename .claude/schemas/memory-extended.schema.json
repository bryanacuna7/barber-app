{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Extended Memory Schema for Claude Starter Kit",
  "description": "Schema for workflow history, agent patterns, and session tracking",
  "type": "object",
  "properties": {
    "workflows": {
      "type": "object",
      "description": "History of workflow executions and patterns",
      "properties": {
        "history": {
          "type": "array",
          "description": "Chronological list of workflow executions",
          "items": {
            "type": "object",
            "required": ["id", "timestamp", "trigger", "steps"],
            "properties": {
              "id": {
                "type": "string",
                "description": "Unique workflow execution ID"
              },
              "timestamp": {
                "type": "string",
                "format": "date-time",
                "description": "When the workflow started"
              },
              "trigger": {
                "type": "string",
                "description": "What initiated this workflow (user request, command, etc.)"
              },
              "type": {
                "type": "string",
                "enum": ["feature", "bug-fix", "refactor", "enhancement", "deployment", "review"],
                "description": "Type of workflow"
              },
              "steps": {
                "type": "array",
                "description": "Steps executed in this workflow",
                "items": {
                  "type": "object",
                  "required": ["agent", "action", "timestamp"],
                  "properties": {
                    "agent": {
                      "type": "string",
                      "description": "Agent that executed this step"
                    },
                    "action": {
                      "type": "string",
                      "description": "Action performed"
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "duration": {
                      "type": "number",
                      "description": "Duration in seconds"
                    },
                    "status": {
                      "type": "string",
                      "enum": ["success", "failed", "skipped"],
                      "default": "success"
                    },
                    "filesModified": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Files modified in this step"
                    }
                  }
                }
              },
              "outcome": {
                "type": "string",
                "enum": ["success", "partial", "failed"],
                "description": "Overall outcome"
              },
              "duration": {
                "type": "number",
                "description": "Total duration in seconds"
              },
              "filesChanged": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "All files modified in this workflow"
              },
              "commitHash": {
                "type": "string",
                "description": "Git commit hash if committed"
              }
            }
          }
        },
        "patterns": {
          "type": "array",
          "description": "Detected workflow patterns from history",
          "items": {
            "type": "object",
            "required": ["pattern", "frequency", "lastSeen"],
            "properties": {
              "pattern": {
                "type": "string",
                "description": "Description of the pattern (e.g., 'UI → Security → Test')"
              },
              "sequence": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Agent sequence that forms this pattern"
              },
              "frequency": {
                "type": "integer",
                "description": "Number of times this pattern occurred"
              },
              "lastSeen": {
                "type": "string",
                "format": "date-time",
                "description": "Last time this pattern was observed"
              },
              "successRate": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Success rate of this pattern (0-1)"
              },
              "context": {
                "type": "string",
                "description": "When this pattern is typically used"
              }
            }
          }
        }
      }
    },
    "agentInvocations": {
      "type": "object",
      "description": "Track agent usage and decision history",
      "properties": {
        "history": {
          "type": "array",
          "description": "Individual agent invocations",
          "items": {
            "type": "object",
            "required": ["agent", "timestamp", "trigger", "decision"],
            "properties": {
              "agent": {
                "type": "string",
                "description": "Agent name (e.g., '@frontend-specialist')"
              },
              "timestamp": {
                "type": "string",
                "format": "date-time"
              },
              "trigger": {
                "type": "string",
                "description": "What triggered this agent"
              },
              "keywords": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Keywords that matched for this agent"
              },
              "decision": {
                "type": "string",
                "description": "Key decision made by this agent"
              },
              "duration": {
                "type": "number",
                "description": "How long the agent worked (seconds)"
              },
              "filesModified": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "followedBy": {
                "type": "string",
                "description": "Next agent in sequence (if any)"
              }
            }
          }
        },
        "statistics": {
          "type": "object",
          "description": "Agent usage statistics",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "count": {
                "type": "integer",
                "description": "Times this agent was invoked"
              },
              "avgDuration": {
                "type": "number",
                "description": "Average duration in seconds"
              },
              "successRate": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              },
              "lastUsed": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        }
      }
    },
    "sessions": {
      "type": "object",
      "description": "Session tracking and continuity",
      "properties": {
        "current": {
          "type": "object",
          "description": "Current active session",
          "properties": {
            "id": {
              "type": "string"
            },
            "startTime": {
              "type": "string",
              "format": "date-time"
            },
            "workflowsExecuted": {
              "type": "integer",
              "default": 0
            },
            "agentsUsed": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "history": {
          "type": "array",
          "description": "Past sessions",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "startTime": {
                "type": "string",
                "format": "date-time"
              },
              "endTime": {
                "type": "string",
                "format": "date-time"
              },
              "duration": {
                "type": "number",
                "description": "Duration in seconds"
              },
              "workflowsExecuted": {
                "type": "integer"
              },
              "filesModified": {
                "type": "integer"
              },
              "commitsCreated": {
                "type": "integer"
              }
            }
          }
        }
      }
    },
    "recommendations": {
      "type": "object",
      "description": "System-generated recommendations based on patterns",
      "properties": {
        "nextSteps": {
          "type": "array",
          "description": "Suggested next steps based on current context",
          "items": {
            "type": "object",
            "properties": {
              "suggestion": {
                "type": "string",
                "description": "The suggestion text"
              },
              "confidence": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Confidence in this suggestion (0-1)"
              },
              "reasoning": {
                "type": "string",
                "description": "Why this is suggested"
              },
              "pattern": {
                "type": "string",
                "description": "Pattern this is based on"
              }
            }
          }
        },
        "warnings": {
          "type": "array",
          "description": "Warnings based on detected anti-patterns",
          "items": {
            "type": "object",
            "properties": {
              "message": {
                "type": "string"
              },
              "severity": {
                "type": "string",
                "enum": ["low", "medium", "high"]
              },
              "suggestion": {
                "type": "string",
                "description": "How to avoid this issue"
              }
            }
          }
        }
      }
    },
    "userPreferences": {
      "type": "object",
      "description": "Learned user preferences and patterns",
      "additionalProperties": true
    }
  }
}
